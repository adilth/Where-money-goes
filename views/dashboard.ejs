<%- include('partials/header.ejs') -%>
<main id="main" class="main">
  <div class="size-grid">
    <div class="sidebar">
      <div class="side-bar">
        <form action="/home/range/:from&:to" method="get" class="form flex">
          <div class="form-cont flex">
            <div class="from-group flex between-space">
              <label for="from">From :</label>
              <input type="date" name="from" id="from" class="date-input">
            </div>
            <div class="from-group flex between-space">
              <label for="to">To :</label>
              <input type="date" name="to" id="to" class="date-input">
            </div>
          </div>
          <button type="submit" class="btn btn-outline-success large">Go</button>
        </form>
      </div>
      <div class="panel-group">
        <p>Click on the Year panel to open specific month or week .</p>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="card-header">
              <% if(tasks == null) {%>
              <div class="nothing">no data found</div>
              <% } else {%>
              <ul>
                <% [... new Set(yearl)].forEach((year) =>{ %>
                <li>
                  <div class="flex between-space">
                    <a href="/home/<%= year %> "><%= year %></a>
                    <a class="btn" data-bs-toggle="collapse" href="#collapse<%=year %>"> <i class="fa fa-chevron-down"></i>
                    </a>
                  </div>

                  <div id="collapse<%=year %>" class="panel-collapse collapse">
                    <div class="panel-body">
                      <ul>
                        <% monthly.forEach((mon) =>{ %>
                        <li>
                          <% var months = ["jan", "feb", "mar", "apr", "may", "jun", "july", "aug", "sep",
                                          "oct", "nov", "dec"];%>
                          <div class="flex between-space">
                            <% if(mon.year == year) {%> 
                            <a class="months" href="/home/month/<%= year%>/<%= mon.month %>">
                              <%= months[mon.month - 1]%></a>
                              <a class="btn" data-bs-toggle="collapse" href="#collapseM<%=mon.month  %> ">
                                <i class="fa fa-chevron-down"></i></a>
                          </div>
                          <div id="collapseM<%= mon.month %>" class="penel-collapse collapse">
                            <div class="panel-body">
                              <% [...new Set(tasks.map((week) => { %>
                              <%    var oneJan = new Date(week.spendAt.getFullYear(),0,1);%>
                              <%   var numberOfDays = Math.floor((week.spendAt - oneJan) / (24 * 60 * 60 * 1000));%>
                              <% return Math.ceil(( week.spendAt.getDay() + 1 + numberOfDays) / 7) %>
                              <% }))].forEach((week) => { %>
                              <a class="months" href="/home/week/<%= week %> "><%=week  %> </a>
                              <% }) %>
                            </div>
                          </div>
                        </li>
                        <% } %> 
                        <% }) %>
                      </ul>
                    </div>
                  </div>
                </li>
                <% }) %>
              </ul>
              <% } %>
              <!-- do on if statement and check if there in other years  -->
            </h4>
          </div>
        </div>
      </div>
    </div>

    <!-- <div class=" row"> -->
    <div class="main-content dashboard">
      <div class="content-task">
        <div class="main-header">
          <div class="linkNewAdd"><a class="fosz" href="/home/new">New Spend<i class="fa fa-plus"></i></a></div>
          <div class="card">
          <p class="total">Total: $<% if(total.length > 0){  %>
          <%= total[0].count %> 
          <% } %> 
          </p>
        </div>
        </div>
        
        <h4 class="title-head">Your expenses for all times</h4>
      </div>

      <div class="main-board">
        <ul>
          <div class="dashboard-cards">
            <% tasks.forEach(task => {%>
            <div class="card card-ds">
              <div class="card-header">
                <li class="card-title fosz text-center"> <%= task.task %></li>

              </div>
              <div class="card-body">
                <div class="card-body">
                  <li class="card-text card-money">
                    <%= task.spend%> $
                  </li>
                  <li class="card-text ">
                    <%= task.info%>
                  </li>
                  <li class="col-6 mt-5">
                    <a class="card-link" href="/home/spendsDetail/<%= task._id%>">
                      more details
                    </a>
                  </li>
                </div>

                <div class="mb-1 p-1 flex between-space">
                  <a class="card-link" href="/home/editTask/<%= task._id %>">Edit</a> &nbsp;
                  <form action="/home/deletePost/<%= task._id %>" method="POST" id="delete-form">
                    <input type="hidden" name="_method" value="DELETE" />
                    <button type="submit" class="card-link" onclick="return confirm('Are you sure you wish to delete this?');">Delete
                    </button>
                  </form>
                </div>
              </div>
              <div class="card-footer text-muted">
                <li class="card-subtitle mb-2 text-muted ">
                  <%= moment(task.spendAt).format("MMMM Do YYYY")%>
                </li>
              </div>
            </div>

            <% }) %>
          </div>
        </ul>
        <div class="pages">
          <ul>
            <% for(let i = 1; i <= totalPages; i++){ %>
            <li> <a href="/home?page=<%=i%> "><%=i %></a></li>
            <% } %>
          </ul>
        </div>
      </div>
    </div>

    <!-- </div> -->


  </div>
</main>

<%- include('partials/footer.ejs') -%>